import*as THREE from"https://cdn.skypack.dev/three@0.129.0/build/three.module.js";import{GLTFLoader}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/loaders/GLTFLoader.js";document.addEventListener("DOMContentLoaded",()=>{let t=new Lenis,l=(t.on("scroll",ScrollTrigger.update),gsap.ticker.add(e=>{t.raf(1e3*e)}),gsap.ticker.lagSmoothing(0),document.querySelector("#webgl")),c=new THREE.WebGLRenderer({antialias:!0,alpha:!0,powerPreference:"high-performance",precision:"highp"}),p=(c.setPixelRatio(Math.min(window.devicePixelRatio||1,1)),c.outputColorSpace=THREE.SRGBColorSpace,l.appendChild(c.domElement),c.setSize(l.clientWidth||window.innerWidth,l.clientHeight||window.innerHeight),new THREE.Scene),h=new THREE.PerspectiveCamera(50,(l.clientWidth||window.innerWidth)/(l.clientHeight||window.innerHeight),.1,1e3);p.add(h);var e=new GLTFLoader;let w=null,u=new THREE.Vector3(1,1,1),E,m=new THREE.Vector3(0,0,0),g=(e.load("./assets/images/the_cube.glb",e=>{var t,n,o,a,i,e=e.scene,r=(w=new THREE.Group,e.traverse(e=>{e.isMesh&&(e.castShadow=!0)}),w.add(e),(new THREE.Box3).setFromObject(w)),s=(r.getSize(u),new THREE.Vector3),e=(r.getCenter(s),e.position.sub(s),p.add(w),new THREE.Sphere),s=(r.getBoundingSphere(e),Math.max(e.radius,1e-4)),e=THREE.MathUtils.degToRad(h.fov),d=s/Math.tan(e/2),e=2*Math.atan(Math.atan(e/2)*h.aspect),s=s/Math.tan(e/2);E=1.5*Math.max(d,s),h.position.set(0,.25*u.y,E),h.near=Math.max(E/200,.01),h.far=200*E,h.updateProjectionMatrix(),h.lookAt(0,0,0),e=r,d=new THREE.CircleGeometry(8,64),s=new THREE.ShadowMaterial({opacity:.22}),(g=new THREE.Mesh(d,s)).rotation.x=-Math.PI/2,g.position.y=e.min.y+.001,g.receiveShadow=!0,(T=new THREE.Mesh(d,new THREE.MeshStandardMaterial({color:14541543,roughness:1,metalness:0}))).position.y=e.min.y,c.shadowMap.enabled=!0,c.shadowMap.type=THREE.PCFSoftShadowMap,y=new THREE.HemisphereLight(16777215,14541543,1),p.add(y),(H=new THREE.DirectionalLight(16777215,1.1)).position.set(3,6,3),H.castShadow=!0,H.shadow.mapSize.set(1024,1024),H.shadow.camera.left=-8,H.shadow.camera.right=8,H.shadow.camera.top=8,H.shadow.camera.bottom=-8,H.shadow.camera.near=.5,H.shadow.camera.far=30,p.add(H),p.background=new THREE.Color(1118481),p.fog=new THREE.Fog(16119803,.9*E,3*E),w&&(r=document.querySelector("#stage")||l.parentElement||document.body,r=gsap.timeline({scrollTrigger:{id:"spinPin",trigger:r,start:"top top",end:`+=${3*window.innerHeight}px`,pin:!0,scrub:!0}}),s={x:.45*-E,y:.45*u.y,z:.85*E},d={x:.9*-E,y:.2*u.y,z:0*E},e=6.5,i=a=2.5,t=3.5,n=5,o=-2,r.to(w.rotation,{x:"+="+2*Math.PI,ease:"none",duration:1}),r.to(h.position,{x:s.x,y:s.y,z:s.z,ease:"power1.inOut",duration:1},"<"),r.to(H.position,{x:a,y:e,z:i,ease:"power1.inOut",duration:1},"<"),r.to(w.rotation,{y:"+="+Math.PI/2,ease:"none",duration:1}),r.to(h.position,{x:d.x,y:d.y,z:d.z,ease:"power1.inOut",duration:1},"<"),r.to(H.position,{x:t,y:n,z:o,ease:"power1.inOut",duration:1},"<")),function e(){h.lookAt(m),c.render(p,h),requestAnimationFrame(e)}()},void 0,function(e){console.error(e)}),null),T=null;let y=null,H=null;l.style.touchAction="none";let o=!(l.style.cursor="grab"),a=0,i=0,r=0,s=0,n=null,d=.005,M=-Math.PI/2+.05,R=Math.PI/2-.05;function x(){var e=window.innerWidth,t=window.innerHeight;c.setSize(e,t),h.aspect=Math.max(e,1)/Math.max(t,1),h.updateProjectionMatrix(),ScrollTrigger&&requestAnimationFrame(()=>ScrollTrigger.refresh())}l.addEventListener("pointerdown",function(e){w&&(o=!0,l.setPointerCapture(e.pointerId),l.style.cursor="grabbing",a=e.clientX,i=e.clientY,r=s=0,n&&n.kill(),e.preventDefault())},{passive:!1}),l.addEventListener("pointermove",function(e){var t,n;o&&w&&(t=e.clientX-a,n=e.clientY-i,a=e.clientX,i=e.clientY,r=t,s=n,w.rotation.y+=t*d,w.rotation.x=THREE.MathUtils.clamp(w.rotation.x+n*d,M,R))},{passive:!1}),l.addEventListener("pointerup",function(e){var t;w&&(o=!1,l.releasePointerCapture(e.pointerId),l.style.cursor="grab",e=w.rotation.y+r*d*10,t=THREE.MathUtils.clamp(w.rotation.x+s*d*10,M,R),n=gsap.to(w.rotation,{x:t,y:e,duration:.6,ease:"power3.out"}))},{passive:!1}),window.addEventListener("resize",x,{passive:!0}),x()});